-- MySQL Script generated by MySQL Workbench
-- lun 19 nov 2018 12:40:17 CST
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

-- SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
-- SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
-- SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema sivo
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema sivo
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `sivo` DEFAULT CHARACTER SET utf8 ;
USE `sivo` ;

-- -----------------------------------------------------
-- Table `sivo`.`unidad`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`unidad` (
  `id_unidad` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_unidad`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`division`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`division` (
  `id_division` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `id_unidad` INT NULL,
  PRIMARY KEY (`id_division`),
  INDEX `fk_division_unidad_idx` (`id_unidad` ASC),
  CONSTRAINT `fk_division_unidad`
    FOREIGN KEY (`id_unidad`)
    REFERENCES `sivo`.`unidad` (`id_unidad`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`matricula`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`matricula` (
  `matricula` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`matricula`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`alumno`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`alumno` (
  `matricula` VARCHAR(10) NOT NULL,
  `nombre` VARCHAR(45) NULL,
  `paterno` VARCHAR(45) NULL,
  `materno` VARCHAR(45) NULL,
  `id_division` INT NOT NULL,
  `id_unidad` INT NOT NULL,
  PRIMARY KEY (`matricula`),
  INDEX `fk_alumno_division_idx` (`id_division` ASC),
  INDEX `fk_alumno_unidad_idx` (`id_unidad` ASC),
  CONSTRAINT `fk_alumno_division`
    FOREIGN KEY (`id_division`)
    REFERENCES `sivo`.`division` (`id_division`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_alumno_unidad`
    FOREIGN KEY (`id_unidad`)
    REFERENCES `sivo`.`unidad` (`id_unidad`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_alumno_login`
    FOREIGN KEY (`matricula`)
    REFERENCES `sivo`.`matricula` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`rol`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`rol` (
  `id_rol` INT NOT NULL,
  `rol` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_rol`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`login`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`login` (
  `matricula` VARCHAR(10) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  `id_rol` INT NOT NULL,
  PRIMARY KEY (`matricula`),
  INDEX `fk_login_rol_idx` (`id_rol` ASC),
  CONSTRAINT `fk_login_rol`
    FOREIGN KEY (`id_rol`)
    REFERENCES `sivo`.`rol` (`id_rol`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_login_matricula`
    FOREIGN KEY (`matricula`)
    REFERENCES `sivo`.`matricula` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`administrador`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`administrador` (
  `matricula` VARCHAR(10) NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `id_unidad` INT NOT NULL,
  PRIMARY KEY (`matricula`),
  INDEX `fk_administrador_unidad_idx` (`id_unidad` ASC),
  CONSTRAINT `fk_administrador_unidad`
    FOREIGN KEY (`id_unidad`)
    REFERENCES `sivo`.`unidad` (`id_unidad`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_administrador_login`
    FOREIGN KEY (`matricula`)
    REFERENCES `sivo`.`matricula` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`encuesta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`encuesta` (
  `id_encuesta` INT NOT NULL AUTO_INCREMENT,
  `titulo` VARCHAR(45) NOT NULL,
  `descripcion` VARCHAR(100) NOT NULL,
  `abre` DATETIME(0) NOT NULL,
  `cierra` DATETIME(0) NOT NULL,
  `creacion` TIMESTAMP(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `id_unidad` INT NULL,
  PRIMARY KEY (`id_encuesta`),
  INDEX `fk_encuesta_unidad_idx` (`id_unidad` ASC),
  CONSTRAINT `fk_encuesta_unidad`
    FOREIGN KEY (`id_unidad`)
    REFERENCES `sivo`.`unidad` (`id_unidad`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`opcion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`opcion` (
  `id_opcion` INT NOT NULL AUTO_INCREMENT,
  `id_encuesta` INT NOT NULL,
  `opcion` VARCHAR(70) NOT NULL,
  PRIMARY KEY (`id_opcion`),
  INDEX `fk_opcion_encuesta_idx` (`id_encuesta` ASC),
  CONSTRAINT `fk_opcion_encuesta`
    FOREIGN KEY (`id_encuesta`)
    REFERENCES `sivo`.`encuesta` (`id_encuesta`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `sivo`.`votacion`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `sivo`.`votacion` (
  `id_encuesta` INT NOT NULL,
  `matricula` VARCHAR(10) NOT NULL,
  `id_opcion` INT NOT NULL,
  `emision` TIMESTAMP(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_encuesta`, `matricula`),
  INDEX `fk_votacion_alumno_idx` (`matricula` ASC),
  INDEX `fk_votacion_opcion_idx` (`id_opcion` ASC),
  CONSTRAINT `fk_votacion_encuesta`
    FOREIGN KEY (`id_encuesta`)
    REFERENCES `sivo`.`encuesta` (`id_encuesta`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_votacion_alumno`
    FOREIGN KEY (`matricula`)
    REFERENCES `sivo`.`alumno` (`matricula`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_votacion_opcion`
    FOREIGN KEY (`id_opcion`)
    REFERENCES `sivo`.`opcion` (`id_opcion`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- SET SQL_MODE=@OLD_SQL_MODE;
-- SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
-- SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `sivo`.`unidad`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`unidad` (`id_unidad`, `nombre`) VALUES (1, 'Azcapotzalco');
INSERT INTO `sivo`.`unidad` (`id_unidad`, `nombre`) VALUES (2, 'Cuajimalpa');

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`division`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`division` (`id_division`, `nombre`, `id_unidad`) VALUES (1, 'Ciencias Basicas e Ingenieria', 1);
INSERT INTO `sivo`.`division` (`id_division`, `nombre`, `id_unidad`) VALUES (4, 'Ciencias Naturales e Ingenieria', 2);
INSERT INTO `sivo`.`division` (`id_division`, `nombre`, `id_unidad`) VALUES (2, 'Ciencias Sociales y Humanidades', 1);
INSERT INTO `sivo`.`division` (`id_division`, `nombre`, `id_unidad`) VALUES (3, 'Ciencias y Artes para el Diseño', 1);
INSERT INTO `sivo`.`division` (`id_division`, `nombre`, `id_unidad`) VALUES (5, 'Ciencias de la Comunicación y Diseño', 2);
INSERT INTO `sivo`.`division` (`id_division`, `nombre`, `id_unidad`) VALUES (6, 'Ciencias Sociales y Humanidades', 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`matricula`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('2143032439');
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('123456');
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('789456');
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('2143032438');
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('2143010101');
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('2143020202');
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('2143030303');
INSERT INTO `sivo`.`matricula` (`matricula`) VALUES ('2143040404');

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`alumno`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_division`, `id_unidad`) VALUES ('2143032439', 'Emilio', 'Hernandez', 'Segovia', 1, 1);
INSERT INTO `sivo`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_division`, `id_unidad`) VALUES ('2143032438', 'Daniel', 'Sanchez', 'Perez', 2, 1);
INSERT INTO `sivo`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_division`, `id_unidad`) VALUES ('2143010101', 'Irma', 'Torres', 'Gómez', 3, 1);
INSERT INTO `sivo`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_division`, `id_unidad`) VALUES ('2143020202', 'Fernanda', 'Nuñez', 'Yañez', 4, 2);
INSERT INTO `sivo`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_division`, `id_unidad`) VALUES ('2143030303', 'Raúl', 'Pereira', 'Contreras', 5, 2);
INSERT INTO `sivo`.`alumno` (`matricula`, `nombre`, `paterno`, `materno`, `id_division`, `id_unidad`) VALUES ('2143040404', 'Mónica', 'Cabrera', 'Palafox', 6, 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`rol`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`rol` (`id_rol`, `rol`) VALUES (1, 'admin');
INSERT INTO `sivo`.`rol` (`id_rol`, `rol`) VALUES (2, 'alumno');

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`login`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143032439', '2143032439', 2);
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143032438', '2143032438', 2);
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('123456', '123456', 1);
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('789456', '789456', 1);
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143010101', '2143010101', 2);
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143020202', '2143020202', 2);
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143030303', '2143030303', 2);
INSERT INTO `sivo`.`login` (`matricula`, `password`, `id_rol`) VALUES ('2143040404', '2143040404', 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`administrador`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`administrador` (`matricula`, `nombre`, `id_unidad`) VALUES ('123456', 'AdminUno', 1);
INSERT INTO `sivo`.`administrador` (`matricula`, `nombre`, `id_unidad`) VALUES ('789456', 'AdminDos', 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`encuesta`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`encuesta` (`id_encuesta`, `titulo`, `descripcion`, `abre`, `cierra`, `creacion`, `id_unidad`) VALUES (default, 'Paro', 'Por falta de agua', now(), now() + interval 1 day, default, 1);
INSERT INTO `sivo`.`encuesta` (`id_encuesta`, `titulo`, `descripcion`, `abre`, `cierra`, `creacion`, `id_unidad`) VALUES (default, 'Paro', 'Por falta de rector', now(), now() + interval 1 day, default, 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `sivo`.`opcion`
-- -----------------------------------------------------
START TRANSACTION;
USE `sivo`;
INSERT INTO `sivo`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 1, 'si');
INSERT INTO `sivo`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 1, 'no');
INSERT INTO `sivo`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 2, 'si');
INSERT INTO `sivo`.`opcion` (`id_opcion`, `id_encuesta`, `opcion`) VALUES (default, 2, 'no');

COMMIT;

GRANT ALL PRIVILEGES ON sivo.* to emilio@'localhost' IDENTIFIED BY 'emilio';
-- GRANT ALL PRIVILEGES ON sivo.* to laura@'localhost' IDENTIFIED BY 'laura';